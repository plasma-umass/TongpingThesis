\label{chapter:sherifftools}

False sharing is a well-known performance issue~\cite{falseshare:Analysis, falseshare:effect}. We have discussed this problem in Section~\ref{sec:falsesharingproblems}. 

Detecting false sharing requires tools support. Existing tools share a similar shortcoming, where they can not pinpoint the exact place with false sharing problems, leaving the burden of finding actual places to programmers. Besides that, existing tools suffer from one or more different shortcomings.  Simulation based approaches ~\cite{falseshare:simulator} and binary instrumentation based approaches~\cite{falseshare:binaryinstrumentation1, falseshare:binaryinstrumentation2} normally introduce very significant performance overhead, slowing down the execution over $100\times$. Hardware performance counter based approaches generally provides much better performance, but they can not differentiate false sharing from true sharing problems~\cite{detect:ptu, detect:intel}.

We provide two tools to tackle with false sharing problem, based on the processes-as-threads framework - \sheriff{}. \Sheriff{} is a drop-in replacement library  of standard \pthreads{} library, which doesn't rely on any advanced hardware support and is a software-only framework. Based on this framework, we develop \SheriffDetect{}. It detects false sharing problem accurately (without false positives) and precisely, by pointing out the exact places with false sharing problems. Also, \SheriffDetect{} is very efficient, only introducing 20\% performance overhead. We also provide a runtime system, \SheriffProtect{}, to automatically tolerate false sharing problems when rewriting an application to resolve false sharing is infeasible or impractical. The reason can be caused by either source is unavailable, or padding data structures would degrade performance because of reduced cache utilization and/or increase memory footprint.


%\section{\sheriff{} Framework}
%\input{sheriff/overview}

\section{Detecting False Sharing}
\input{sheriff/detection}

\section{Tolerating False Sharing}
\input{sheriff/prevention}

\section{Experimental Evaluation}
\input{sheriff/evaluation}
