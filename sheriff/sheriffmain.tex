Multithreading is an useful abstraction to exploit the hardware resources provided by a multi-core machine. Writing efficient multithreading programs remains challenging now. False sharing problem is one of notorious performance problem inside
multithreading programs. It occurs when multiple threads, running on different cores with separate caches, are accessing logically independent words in the same cache line. If a thread modify something inside a cache line, cache coherence protocol invalidates the duplicates of this cache line in other caches in order to guarantee a correct execution of a program, which is crucial for true sharing cases. However, it is totally unnecessary for false sharing cases. False sharing problem can force one core to wait unnecessarily for updates from another processor, thus waste both the CPU time and precious memory bandwidth in the same time. False sharing is a well-known performance issue~\cite{falseshare:Analysis, falseshare:effect}. 

Detecting false sharing requires tools support. All existing tools shared the same shortcoming, where they can not pinpoint the exact place with false sharing problems, leaving the burden of finding actual places to programmers. Besides that, existing tools suffer from one or more shortcomings.  Simulation based approaches ~\cite{falseshare:simulator} and binary instrumentation based approaches~\cite{falseshare:binaryinstrumentation1, falseshare:binaryinstrumentation2} normally introduce very significant performance overhead, slowing down the execution over $100\times$. Hardware performance counter based approaches generally provides much better performance, but they can not differentiate false sharing from true sharing problems~\cite{detect:ptu, detect:intel}.

We provide two tools to tackle with false sharing problem, based on the processes-as-threads framework - \sheriff{}. \SheriffDetect{} detects false sharing problem accurately (without false positives) and precisely, by pointing out the exact places with false sharing problems. Also, \SheriffDetect{} is very efficient, only introducing 20\% performance overhead. \Sheriff{} is a drop-in replacement library  of standard \pthreads{} library, which doesn't rely on advanced hardware support to find the problem.
We also provide a runtime system, \SheriffProtect{}, to automatically tolerate false sharing problems when rewriting an application to resolve false sharing is infeasible or impractical. The reason can be caused by either source is unavailable, or padding data structures would degrade performance because of reduced cache utilization and/or increase memory footprint.


\section{\sheriff{} Framework}
\input{sheriff/overview}

\section{Detecting False Sharing}
\input{sheriff/detection}

\section{Tolerating False Sharing}
\input{sheriff/prevention}

\section{Experimental Evaluation}
\input{sheriff/evaluation}
